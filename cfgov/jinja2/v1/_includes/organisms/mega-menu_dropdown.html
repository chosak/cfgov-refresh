{% import '_vars-mega-menu.html' as vars with context %}
{% set base_class = 'o-mega-menu' %}

{# ==========================================================================

   _classes()

   ==========================================================================

   Description:

   Creates mega menu CSS classes when given:

   nav_depth: Level of menu nesting. 1 equals the root menu.

   suffix:    Suffix to add to the classes.
              Default is ''.

   ========================================================================== #}

{# TODO: Move to external macro so it can be shared with secondary nav. #}
{%- macro _classes( nav_depth, suffix='' ) -%}
{%- set general_class = base_class ~ '_content' -%}
{%- set depth_class = general_class ~ '-' ~ nav_depth -%}
{{ general_class ~ suffix ~ ' ' ~ depth_class ~ suffix }}
{%- endmacro -%}


{# ==========================================================================

   _nav_list()

   ==========================================================================

   Description:

   Creates a mega menu sub menu list markup when given:

   nav_depth: Level of menu nesting. 1 equals the root menu.

   nav_items: An array of tuples containing menu link info.

   ========================================================================== #}

{% macro _nav_list( nav_depth, nav_items ) %}
{%- for nav_group in nav_items %}
<ul class="list
           list__unstyled
           {{ _classes( nav_depth, '-list' ) if nav_depth == 2 else '' }}">
    {%- for nav_caption,
            nav_url,
            nav_children in nav_group %}
    <li class="list_item
               {{ _classes( nav_depth, '-item' ) }}"
        {{ 'data-js-hook=behavior_flyout-menu' if nav_depth == 1 else '' }}>
        {# TODO: Disable link (or overview link) of page user is currently on (on mobile). #}
        <a class="{{ 'u-link__disabled' if nav_url == '' else '' }}
                  {{ _classes( nav_depth, '-link' ) }}
                  {{ _classes( nav_depth, '-link__current' ) if nav_url == request.path else '' }}"
           {{ '' if nav_url == '' else 'href=' + nav_url | e }}
           {{ 'data-js-hook=behavior_flyout-menu_trigger' if nav_depth == 1 else '' }}
           {{ 'aria-pressed=false' if nav_depth == 1 else '' }}>
            {{ nav_caption }}
        </a>
        {% if nav_depth == 1 %}
            {{ _nav( nav_depth | int + 1, nav_children, nav_caption ~ ' Overview', nav_url, vars.media_items ) }}
        {% endif %}
    </li>
    {%- endfor %}
</ul>
{%- endfor %}
{% endmacro %}

{# ==========================================================================

   _nav()

   ==========================================================================

   Description:

   Creates menu content markup when given:

   nav_depth:        Level of menu nesting. 1 equals the root menu.

   nav_items:        An array of tuples containing menu link info.

   nav_overview:     A string used for a sub nav overview title.

   nav_overview_url: A string used for a sub nav overview title URL.

   media_items:      A tuple of strings composed of HTML markup.

   ========================================================================== #}

{% macro _nav( nav_depth, nav_items, nav_overview, nav_overview_url, media_items ) %}

{% if nav_depth == 1 %}

<div class="{{ _classes( nav_depth ) }}">
    {{ _nav_list( nav_depth, nav_items ) }}
</div>

{% else %}
<div class="{{ _classes( nav_depth ) }}
            u-hidden-overflow"
     aria-expanded="false"
     data-js-hook="behavior_flyout-menu_content">

    <div class="{{ _classes( nav_depth, '-wrapper' ) }}">

        <div class="wrapper wrapper__match-content">

            <div class="{{ _classes( nav_depth, '-col-group') }}">
                <div class="{{ _classes( nav_depth, '-grid' ) }}">
                    <span class="{{ _classes( nav_depth, '-overview' ) }}">
                        {# TODO: Remove the check for '#' when real overview pages
                                 are added for the Consumer Resources and Education
                                 pages. #}
                        {% if nav_overview_url %}
                        <a class="{{ 'u-link__disabled' if nav_overview_url == '#' else '' }}
                                  {{ _classes( nav_depth, '-overview-link' ) }}
                                  {{ _classes( nav_depth, '-overview-link__current' ) if nav_overview_url == request.path else '' }}"
                           {{ '' if nav_overview_url == request.path or nav_overview_url == '#' else 'href=' + nav_overview_url | e }}>
                            {{ nav_overview }}
                        </a>
                        {% endif %}
                    </span>

                    <div class="{{ _classes( nav_depth, '-lists' ) }}">
                        {{ _nav_list( nav_depth, nav_items ) }}
                    </div>
                </div>
                {% for url, fmc in media_items %}
                    {% if url == nav_overview_url %}
                    {{ fmc }}
                    {% endif %}
                {% endfor %}
            </div>

        </div>

    </div>

</div>
{% endif %}

{% endmacro %}

{# ==========================================================================

   Mega Menu

   ==========================================================================

   Description:

   Creates a mega menu primary navigation menu.

   ========================================================================== #}
<nav class="{{ base_class }} {{ base_class }}__dropdown"
     aria-label="main navigation"
     role="navigation">
    {# Create a root menu at depth one.
       This is the 1st level of a 3-level menu. #}
    {{ _nav( 1, vars.nav_items ) }}
    <button class="{{ base_class ~ '_tab-trigger' }}" aria-hidden="true"></button>
</nav>
